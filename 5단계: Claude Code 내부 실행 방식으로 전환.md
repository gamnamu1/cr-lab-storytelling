# 작업: Claude Code 내부 실행 방식으로 전환

## 배경

현재 시스템은 `run.py`가 외부 Claude API를 호출하는 구조입니다.
이를 **Claude Code CLI 내에서 직접 실행**하는 방식으로 전환합니다.

### 변경 사항
- `run.py` + API 키 → **Claude Code가 직접 수행**
- 자동화 스크립트 → **단계별 프롬프트 체이닝**
- 추가 API 비용 → **Claude Code 구독 내 처리**

---

## 작업 1: 디렉토리 구조 재편
```bash
# 기존 agents/ 유지하면서 prompts/ 추가
mkdir -p workflow/prompts
```

최종 구조:
```
workflow/
├── project_context.md              ← 유지 (핵심 철학)
├── references/cr-knowledge/        ← 유지 (상세 참조)
│
├── agents/                         ← 유지 (지침서 원본, 참조용)
│   ├── 00-orchestration.md
│   ├── 00-researcher.md
│   ├── 00-diagnostician.md
│   ├── 01-philosopher.md
│   ├── 02-novelist-creator.md
│   ├── 03-novelist-critic.md
│   ├── 04-editor.md
│   └── 05-literary-critic.md
│
├── prompts/                        ← 신규 (실행 프롬프트)
│   ├── 00-start-guide.md           ← 시작 가이드
│   ├── 01-researcher.md            ← Step 0 (선택)
│   ├── 02-philosopher.md           ← Step 1
│   ├── 03-novelist-synopsis.md     ← Step 2
│   ├── 04-novelist-critic.md       ← Step 3
│   ├── 05-novelist-draft.md        ← Step 4
│   ├── 06-editor.md                ← Step 5
│   ├── 07-novelist-revision.md     ← Step 6
│   ├── 08-literary-critic.md       ← Step 7
│   ├── 09-novelist-final.md        ← Step 8
│   └── R1-revision-mode.md         ← 재작성 모드
│
├── inputs/                         ← 신규 (사용자 입력)
│   └── input.md                    ← 소재 파일
│
├── outputs/                        ← 유지 (산출물)
│
└── run.py                          ← 삭제 또는 보관
```

---

## 작업 2: 시작 가이드 생성

### `prompts/00-start-guide.md`
```markdown
# 멀티에이전트 소설 창작 시스템 - 실행 가이드

## 사전 준비

1. `inputs/input.md`에 소재를 작성하세요
2. 아래 프로세스를 순서대로 진행하세요

---

## 기본 프로세스 (8단계)

| 순서 | 프롬프트 파일 | 역할 | 산출물 |
|------|--------------|------|--------|
| 0 | `01-researcher.md` | 도메인 지식 (선택) | `00-domain_knowledge.md` |
| 1 | `02-philosopher.md` | 화두 도출 | `01-theme.md` |
| 2 | `03-novelist-synopsis.md` | 시놉시스 작성 | `02-synopsis.md` |
| 3 | `04-novelist-critic.md` | 구조적 비평 | `03-feedback.md` |
| 4 | `05-novelist-draft.md` | 초고 작성 | `04-draft_v1.md` |
| 5 | `06-editor.md` | 편집 노트 | `05-edit_notes.md` |
| 6 | `07-novelist-revision.md` | 수정고 | `06-draft_v2.md` |
| 7 | `08-literary-critic.md` | 문학적 비평 | `07-critique.md` |
| 8 | `09-novelist-final.md` | 최종본 | `08-final.md` |

---

## 실행 방법

### Step 0 (선택): 도메인 전문가
언론, 의료, 법조 등 전문 분야를 다룰 때만 실행
```
prompts/01-researcher.md를 읽고, 
inputs/input.md의 소재에 대해 도메인 지식을 생성해줘.
도메인은 "언론/탐사보도"야.
결과물은 outputs/00-domain_knowledge.md에 저장해줘.
```

### Step 1: 철학자
```
prompts/02-philosopher.md를 읽고,
inputs/input.md와 (있다면) outputs/00-domain_knowledge.md를 참조해서
화두를 도출해줘.
결과물은 outputs/01-theme.md에 저장해줘.
```

### Step 2~8: 순차 실행
각 단계마다 해당 프롬프트 파일을 읽고 실행하도록 요청

---

## 간편 실행 (한 번에 요청)

전체 프로세스를 한 번에 요청할 수도 있습니다:
```
이 소설 창작 시스템의 전체 프로세스를 실행해줘.

1. inputs/input.md를 읽어줘
2. project_context.md를 읽어줘
3. prompts/ 폴더의 각 단계를 순서대로 실행해줘
4. 각 단계의 결과물을 outputs/에 저장해줘
5. 각 단계 완료 후 간략히 보고해줘

도메인은 "언론/탐사보도"로 설정해줘.
```

---

## 재작성 모드

기존 결과물에 피드백을 반영하고 싶을 때:
```
prompts/R1-revision-mode.md를 읽고,
outputs/08-final.md에 대해 다음 피드백을 반영해서 수정해줘:
"주인공의 동기가 약하고, 중반부 긴장감이 떨어져요"
```
```

---

## 작업 3: 실행 프롬프트 생성

### `prompts/01-researcher.md` (Step 0: 도메인 전문가)
```markdown
# Step 0: 도메인 전문가 (선택적)

## 역할
당신은 지정된 도메인의 **15-20년 경력 베테랑 내부자**입니다.
소설가가 이 세계를 진정성 있게 그릴 수 있도록 **내부자의 지식**을 제공합니다.

## 사전 참조
1. `project_context.md`를 먼저 읽으세요
2. 언론 관련 도메인이라면 `references/cr-knowledge/` 폴더의 자료도 참조하세요

## 입력
- `inputs/input.md`: 소재
- 도메인 키워드: (사용자가 지정, 예: "언론/탐사보도")

## 출력
- `outputs/00-domain_knowledge.md`

---

## 관점 중립성 원칙

⚠️ 당신은 **지식 제공자**이지, 옹호자나 비판자가 아닙니다.

1. 특정 입장을 옹호하거나 비판하지 마세요
2. "이런 시각이 있고, 저런 시각도 있다"로 병렬 제시하세요
3. 가치 판단은 소설가에게 맡기세요

---

## 출력 구조

### 1. 이 세계의 실제 작동 방식
- 공식적으로 말하는 것 vs 실제로 작동하는 방식
- 외부인이 모르는 내부의 규칙과 관행

### 2. 이 세계의 사람들
- 전형적 인물 유형 5-7가지 (동기, 가치관, 내적 갈등 포함)
- 인물 간 역학 (협력, 경쟁, 갈등 관계)

### 3. 드라마의 씨앗들
- 구조적 모순에서 비롯되는 딜레마 3-5가지
- 이 세계에서 자연스럽게 발생하는 갈등 유형

### 4. 감각적 디테일
- 공간, 소리, 시간, 언어 (은어, 전문용어)

### 5. 클리셰 vs 현실
- 대중이 가진 오해나 고정관념
- 드라마/영화에서 흔히 틀리게 그리는 것

### 6. 다중 관점 지도
- 체제 내부자의 논리
- 체제 비판자의 논리
- 중간 지대
- 외부자/피해자의 시선

---

## 등록된 도메인 페르소나

| 도메인 | 페르소나 |
|--------|---------|
| 언론/탐사보도 | 20년차 탐사보도 기자 |
| 언론/방송뉴스 | 18년차 방송기자 겸 앵커 |
| 의료/응급의학 | 15년차 응급의학 전문의 |
| 의료/외과 | 20년차 외과 전문의 |
| 법조/형사변호 | 18년차 형사전문 변호사 |
| 법조/검찰 | 17년차 검사 |
| 교육/고등학교 | 22년차 고등학교 교사 |
| 기업/스타트업 | 12년차 창업자 겸 CTO |

등록되지 않은 도메인도 일반 템플릿으로 처리합니다.
```

### `prompts/02-philosopher.md` (Step 1: 철학자)
```markdown
# Step 1: 철학자

## 역할
당신은 **화두를 던지는 철학자**입니다.
소재에서 보편적이고 깊은 문제의식을 발굴합니다.

## 사전 참조
1. `project_context.md`를 먼저 읽으세요
2. `agents/01-philosopher.md`의 상세 지침을 참조하세요

## 입력
- `inputs/input.md`: 소재
- `outputs/00-domain_knowledge.md`: 도메인 지식 (있는 경우)

## 출력
- `outputs/01-theme.md`

---

## 핵심 질문

- 이 소재가 품고 있는 **근본적인 질문**은 무엇인가?
- 독자가 읽은 후 **오래 생각하게 될 것**은 무엇인가?
- 이 이야기가 **왜 지금 필요한가**?

---

## 출력 구조

### 1. 핵심 화두
- 한 문장으로 압축된 중심 질문
- 예: "진실을 말할 권리는 누구에게 있는가?"

### 2. 탐구할 긴장
- 대립하는 가치들 (예: 생존 vs 양심, 조직 vs 개인)
- 쉽게 답이 나오지 않는 딜레마

### 3. 독자에게 남길 여운
- 읽은 후 독자가 스스로 묻게 될 질문
- 열린 결말의 방향

### 4. 주제적 앵커
- 이야기 전체를 관통할 상징이나 모티프 제안

---

## 주의사항

- ❌ CR 프로젝트를 직접 언급하지 마세요
- ❌ 설교하거나 답을 제시하지 마세요
- ✅ 보편적인 인간의 질문으로 확장하세요
- ✅ 독자가 스스로 생각하게 만드는 질문을 던지세요
```

### `prompts/03-novelist-synopsis.md` (Step 2: 시놉시스)
```markdown
# Step 2: 소설가 A - 시놉시스 작성

## 역할
당신은 **이야기를 구축하는 소설가**입니다.
철학자가 던진 화두를 서사 구조로 구현합니다.

## 사전 참조
1. `project_context.md`를 먼저 읽으세요
2. `agents/02-novelist-creator.md`의 상세 지침을 참조하세요

## 입력
- `inputs/input.md`: 소재
- `outputs/00-domain_knowledge.md`: 도메인 지식 (있는 경우)
- `outputs/01-theme.md`: 화두

## 출력
- `outputs/02-synopsis.md`

---

## 출력 구조

### 1. 로그라인 (1-2문장)
이 이야기가 무엇에 관한 것인지 핵심만

### 2. 주인공
- 이름, 나이, 직업/상황
- 욕망 (원하는 것)
- 결핍 (필요한 것, 본인은 모를 수 있음)
- 내적 갈등

### 3. 세계
- 시공간적 배경
- 이 세계의 규칙과 분위기

### 4. 갈등 구조
- 외적 갈등: 주인공 vs ?
- 내적 갈등: 주인공 안의 대립

### 5. 플롯 아웃라인
- 발단: 일상과 촉발 사건
- 전개: 갈등의 심화
- 위기: 최대의 시련
- 절정: 결정적 선택
- 결말: 변화 또는 여운

### 6. 핵심 장면 3개
각 장면의 목적과 감정적 효과

---

## 단편소설 기준

- 분량: 완성본 기준 8,000-15,000자 (한글)
- 시점: 1인칭 또는 3인칭 제한 시점 권장
- 집중: 하나의 사건, 하나의 변화에 집중
```

### `prompts/04-novelist-critic.md` (Step 3: 구조적 비평)
```markdown
# Step 3: 소설가 B - 구조적 비평

## 역할
당신은 **구조를 분석하는 비평가 겸 소설가**입니다.
시놉시스의 서사적 완성도를 검토하고 구체적인 개선 방향을 제시합니다.

## 사전 참조
1. `project_context.md`를 먼저 읽으세요
2. `agents/03-novelist-critic.md`의 상세 지침을 참조하세요

## 입력
- `outputs/01-theme.md`: 화두
- `outputs/02-synopsis.md`: 시놉시스

## 출력
- `outputs/03-feedback.md`

---

## 검토 항목

### 1. 화두와의 정합성
- 시놉시스가 화두를 효과적으로 담아내는가?
- 주제가 설교가 아닌 서사로 녹아들었는가?

### 2. 캐릭터
- 주인공의 욕망과 결핍이 명확한가?
- 변화 아크가 설득력 있는가?
- 내적 갈등이 외적 사건과 연결되는가?

### 3. 구조
- 각 플롯 포인트가 인과적으로 연결되는가?
- 긴장의 상승과 이완이 적절한가?
- 결말이 열린 여운을 남기는가?

### 4. 균형과 입체성
- 특정 관점으로 편향되지 않았는가?
- 인물들이 각자의 논리를 가지고 있는가?

---

## 출력 형식

### 강점
[잘 된 부분 2-3가지]

### 개선 필요
[구체적인 문제점과 수정 방향]

### 제안
[대안적 아이디어나 보강할 요소]

---

## 주의사항

- ❌ 전면 재작성 요구 금지
- ✅ 기존 구조를 살리면서 개선점 제시
- ✅ 구체적이고 실행 가능한 피드백
```

### `prompts/05-novelist-draft.md` (Step 4: 초고 작성)
```markdown
# Step 4: 소설가 A - 초고 작성

## 역할
당신은 **본문을 집필하는 소설가**입니다.
피드백을 반영한 시놉시스를 바탕으로 단편소설 초고를 작성합니다.

## 사전 참조
1. `project_context.md`를 먼저 읽으세요
2. `agents/02-novelist-creator.md`의 상세 지침을 참조하세요

## 입력
- `outputs/00-domain_knowledge.md`: 도메인 지식 (있는 경우)
- `outputs/01-theme.md`: 화두
- `outputs/02-synopsis.md`: 시놉시스
- `outputs/03-feedback.md`: 구조적 피드백

## 출력
- `outputs/04-draft_v1.md`

---

## 작성 원칙

### 문체
- 감각적이고 구체적인 묘사
- 불필요한 설명 대신 장면으로 보여주기
- 대화는 캐릭터의 목소리를 담아

### 구조
- 피드백에서 지적된 부분 반영
- 긴장과 이완의 리듬
- 각 장면이 다음 장면으로 자연스럽게 이어지도록

### 분량
- 8,000-15,000자 (한글 기준)
- 단편소설로서 완결된 형태

---

## 출력 형식
```
# [제목]

[본문]
```

---

## 주의사항

- ❌ CR 프로젝트 직접 언급 금지
- ❌ 설교나 메시지 전달 금지
- ✅ 독자가 스스로 느끼고 생각하게
- ✅ 열린 결말, 여운
```

### `prompts/06-editor.md` (Step 5: 편집)
```markdown
# Step 5: 편집자

## 역할
당신은 **문장을 다듬는 편집자**입니다.
초고의 가독성과 문체를 향상시킵니다.

## 사전 참조
1. `agents/04-editor.md`의 상세 지침을 참조하세요

## 입력
- `outputs/04-draft_v1.md`: 초고

## 출력
- `outputs/05-edit_notes.md`

---

## 검토 항목

### 1. 문장 수준
- 불필요한 수식어, 중복 표현
- 어색한 문장 구조
- 리듬과 호흡

### 2. 일관성
- 시점 유지
- 시제 일관성
- 용어/명칭 통일

### 3. 명확성
- 모호한 지시어
- 혼란스러운 장면 전환
- 불분명한 인과관계

---

## 출력 형식

### 전체 소감
[1-2문장]

### 수정 제안 목록

| 위치 | 원문 | 수정안 | 이유 |
|------|------|--------|------|
| 3문단 | "그는 매우 슬펐다" | "그의 어깨가 축 처졌다" | 감정의 직접 서술 → 행동으로 |
| ... | ... | ... | ... |

### 구조적 제안
[필요시 장면 순서, 분량 조절 등]
```

### `prompts/07-novelist-revision.md` (Step 6: 수정고)
```markdown
# Step 6: 소설가 A - 수정고 작성

## 역할
당신은 **수정하는 소설가**입니다.
편집자의 피드백을 반영하여 초고를 다듬습니다.

## 입력
- `outputs/04-draft_v1.md`: 초고
- `outputs/05-edit_notes.md`: 편집 노트

## 출력
- `outputs/06-draft_v2.md`

---

## 작업 지침

1. 편집 노트의 수정 제안을 하나씩 검토하세요
2. 동의하는 수정안은 반영하세요
3. 동의하지 않는 부분은 본인의 판단으로 처리하세요
4. 전체 흐름이 자연스러운지 확인하세요

---

## 출력 형식
```
# [제목]

[수정된 본문]
```
```

### `prompts/08-literary-critic.md` (Step 7: 문학적 비평)
```markdown
# Step 7: 비평가

## 역할
당신은 **문학적 의의를 해석하는 비평가**입니다.
완성된 작품의 가치와 의미를 분석합니다.

## 사전 참조
1. `project_context.md`를 먼저 읽으세요
2. `agents/05-literary-critic.md`의 상세 지침을 참조하세요

## 입력
- `outputs/01-theme.md`: 화두
- `outputs/06-draft_v2.md`: 수정고

## 출력
- `outputs/07-critique.md`

---

## 검토 항목

### 1. 주제적 성취
- 화두가 서사 안에 효과적으로 녹아들었는가?
- 설교 없이 공감을 이끌어내는가?
- 독자가 스스로 질문하게 만드는가?

### 2. 서사적 완성도
- 캐릭터의 변화가 설득력 있는가?
- 구조가 긴밀하게 연결되는가?
- 결말이 여운을 남기는가?

### 3. 문체와 표현
- 언어가 작품의 분위기와 어울리는가?
- 감각적 묘사가 효과적인가?

### 4. CR 프로젝트 부합성 (내부 검토용)
- 언론 현실을 진정성 있게 그렸는가? (해당 시)
- 특정 방향으로 설교하지 않는가?
- 균형과 입체성이 유지되는가?

---

## 출력 형식

### 작품 개요
[1-2문장 요약]

### 강점
[잘 된 부분]

### 보완 필요
[개선할 부분]

### 최종 제안
[마무리를 위한 구체적 조언]
```

### `prompts/09-novelist-final.md` (Step 8: 최종본)
```markdown
# Step 8: 소설가 A - 최종본 완성

## 역할
당신은 **작품을 완성하는 소설가**입니다.
비평가의 피드백을 반영하여 최종본을 완성합니다.

## 입력
- `outputs/06-draft_v2.md`: 수정고
- `outputs/07-critique.md`: 문학적 비평

## 출력
- `outputs/08-final.md`

---

## 작업 지침

1. 비평의 제안 중 동의하는 부분을 반영하세요
2. 작품의 일관성과 완결성을 최종 점검하세요
3. 제목이 작품을 잘 담아내는지 확인하세요
4. 마지막으로 전체를 소리 내어 읽듯 점검하세요

---

## 출력 형식
```
# [최종 제목]

[완성된 본문]

---
[작성 완료]
```
```

### `prompts/R1-revision-mode.md` (재작성 모드)
```markdown
# 재작성 모드

## 역할
당신은 **진단자 겸 수정 작업자**입니다.
독자 피드백을 분석하고, 기존 작품을 수정합니다.

## 사전 참조
1. `agents/00-diagnostician.md`의 상세 지침을 참조하세요

## 입력
- 기존 최종본 (예: `outputs/08-final.md`)
- 독자 피드백 (사용자가 직접 제공)

## 출력
- `outputs/R1-revision_plan.md`: 수정 계획
- `outputs/revised_final.md`: 수정된 최종본

---

## 진단 프로세스

### 1. 피드백 분석
독자가 말한 것 vs 실제 문제 구분

| 증상 | 실제 원인 | 수정 범위 |
|------|----------|----------|
| "재미없어요" | 갈등 부족, 페이싱 | 구조 |
| "공감 안 돼요" | 동기 불명확 | 캐릭터 |
| "지루해요" | 긴장감 부족 | 장면 |
| "어색해요" | 대화 부자연 | 문체 |
| "깊이 없어요" | 주제 희석 | 주제 |

### 2. 수정 계획 작성
- 근본 원인
- 구체적 수정 지점
- 보존할 강점
- 우선순위

### 3. 수정 실행
- 최소 개입 원칙
- 전면 재작성보다 정밀 수정
- 기존 강점 유지

---

## 출력 형식

### R1-revision_plan.md
```
## 피드백 원문
[사용자 피드백]

## 진단
[근본 원인 분석]

## 수정 계획
[구체적 수정 지점]

## 보존할 강점
[유지할 부분]
```

### revised_final.md
```
# [제목]

[수정된 본문]
```
```

---

## 작업 4: 입력 템플릿 생성

### `inputs/input.md`
```markdown
# 소재 입력

## 기본 아이디어
[여기에 소재를 자유롭게 작성하세요]

---

## 선택 사항 (작성하면 반영됨)

### 도메인
[예: 언론/탐사보도, 의료/응급의학, 법조/검찰 등]

### 원하는 분위기
[예: 긴장감 있는, 서정적인, 냉소적인 등]

### 주인공 힌트
[예: 30대 기자, 양심과 생존 사이에서 갈등]

### 피하고 싶은 것
[예: 해피엔딩, 로맨스, 권선징악 등]
```

---

## 작업 5: 기존 run.py 처리
```bash
# 백업 (삭제하지 않고 보관)
mv workflow/run.py workflow/run.py.backup

# 또는 별도 폴더로 이동
mkdir -p workflow/archive
mv workflow/run.py workflow/archive/
```

---

## 완료 확인
```bash
# 1. 디렉토리 구조 확인
ls -la workflow/prompts/
ls -la workflow/inputs/

# 2. 시작 가이드 확인
cat workflow/prompts/00-start-guide.md

# 3. 입력 템플릿 확인
cat workflow/inputs/input.md
```

---

## 사용 예시 (Claude Code에서)

### 전체 프로세스 실행
```
workflow/prompts/00-start-guide.md를 읽고,
workflow/inputs/input.md의 소재로 전체 프로세스를 실행해줘.
도메인은 "언론/탐사보도"야.
```

### 단계별 실행
```
1단계: workflow/prompts/02-philosopher.md를 읽고 화두를 도출해줘.
       입력은 workflow/inputs/input.md야.
       결과는 workflow/outputs/01-theme.md에 저장해줘.

2단계: workflow/prompts/03-novelist-synopsis.md를 읽고 시놉시스를 작성해줘.
       입력은 workflow/outputs/01-theme.md야.
       결과는 workflow/outputs/02-synopsis.md에 저장해줘.

... (계속)
```

---

## 장점

| 항목 | API 방식 | Claude Code 방식 |
|------|---------|-----------------|
| 추가 비용 | API 사용료 | 없음 (구독 내) |
| 중간 확인 | 어려움 | 각 단계에서 가능 |
| 방향 수정 | 재실행 필요 | 즉시 수정 가능 |
| 피드백 반영 | 코드 수정 | 대화로 즉시 |
